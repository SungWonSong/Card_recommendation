<!DOCTYPE html>
<html lang="en">
    <%- include('include/include') %>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Detail</title>
    <link rel="stylesheet" href="/css/detail.css">
    <link rel="stylesheet" href="/css/comment.css">
</head>
<body>
    <div class="left-box">
        <div class="container">
            <div class="card">
                <div class="imgBx">
                    <img src="<%= card.card_image ? card.card_image : 'default-image-path' %>" alt="<%= card.card_name %>">
                </div>
                <div class="contentBx">
                    <!-- <h2><%= card.card_name %></h2> -->
                    <a href="" id="viewDetail">ÏÉÅÏÑ∏Î≥¥Í∏∞</a>
                    <a href="/index" id="backButton" style="display: none;">Îí§Î°úÍ∞ÄÍ∏∞</a>
                </div>
            </div>
            <!-- ÏÉàÎ°úÏö¥ div ÏöîÏÜå, Ï≤òÏùåÏóêÎäî Ïà®ÍπÄ -->
            <div class="gradient-border" id="box" style="display: none;">
                <div class="content-container">
                    <h1>Ïπ¥ÎìúÎ≥Ñ ÏÉÅÏÑ∏ ÎÇ¥Ïö©</h1>
                    <!-- Ïπ¥Îìú Ï†ïÎ≥¥ -->
                    <div class="card_info">
                        <div> Ïπ¥ÎìúÏù¥Î¶Ñ :  <%= card.card_name %></div>
                        <div> Ïπ¥ÎìúÌöåÏÇ¨ : <%= card.card_corp %></div>
                    </div>
                    <!-- Ï¢ãÏïÑÏöî Í∏∞Îä•  -->
                    <div class="likes_container">
                        <button id="likeButton">üëç</button>
                        <span id="likesCount"><%= likesCount %> Ï¢ãÏïÑÏöî </span>
                    </div>
                    <!-- ÌòúÌÉù Ï†ïÎ≥¥ -->
                    <div class="benefits_container">
                        <!-- <div class="benefit">
                            <h3>ÏÑúÏ†ê ÌòúÌÉù</h3>
                            <p><%= card.book_details %></p>
                        </div> -->
                        <div class="benefits_container">
                            <% card.Benefits.forEach(benefit => { %>
                                <div class="benefit">
                                    <h3><%= benefit.dataValues.category_name %> ÌòúÌÉù</h3>
                                    <p><%= benefit.dataValues.benefit_details %></p>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="right-box">
        <div class="comments-container">        
            <div class="comment-form">
                <input type="text" id="comment-input" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                <span class="char-counter" id="char-counter">0</span>
                <button id="add-comment" data-card-id="<%= card.card_id %>">Ï∂îÍ∞Ä</button>
            </div>
            <div class="comment-contents">
                <div id="comments-container">
                    <!-- ÎåìÍ∏Ä Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    <% if (comments.length === 0) { %>
                        <div class="no-comments">ÏïÑÏßÅ ÏûÖÎ†•Îêú ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</div>
                    <% } else { %>
                        <% comments.forEach((comment, index) => { %>
                            <% const isTopComment = index < 2; %> <!-- ÏÉÅÏúÑ 2Í∞úÏùò ÎåìÍ∏ÄÏùÑ ÏãùÎ≥Ñ -->
                            <div class="comment <%= isTopComment ? 'top-comment' : '' %>" data-id="<%= comment.comment_id %>">
                                <div class="comment-header">
                                    <div class="comment-author"><%= comment.User.nickname %></div>
                                    <div class="comment-options"><%= new Date(comment.createdAt).toLocaleDateString() %></div>
                                </div>
                                <div class="comment-body">
                                    <%= comment.comment_contents %>
                                </div>
                                <div class="comment-footer">
                                    <span class="likes"><%= comment.likeCount %></span> <!-- Ï¢ãÏïÑÏöî ÏàòÎ•º ÎÇòÌÉÄÎÇ¥Îäî Î∂ÄÎ∂Ñ -->
                                    <span class="comments">0</span> <!-- ÎåìÍ∏Ä ÏàòÎ•º ÎÇòÌÉÄÎÇ¥Îäî Î∂ÄÎ∂Ñ -->
                                    <span class="comment-action" data-comment-id="<%= comment.comment_id %>" data-card-id="<%= comment.card_id %>">Ï¢ãÏïÑÏöî</span> <!-- Ï¢ãÏïÑÏöî Î≤ÑÌäºÏóê card_id Ï∂îÍ∞Ä -->
                                    <% if (user && user.userId === comment.userid) { %>
                                        <button class="edit-comment">ÏàòÏ†ï</button>
                                        <button class="delete-comment">ÏÇ≠Ï†ú</button>
                                    <% } %>
                                </div>
                            </div>
                        <% }) %>
                    <% } %>
                </div>    
            </div>
            <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïª®ÌÖåÏù¥ÎÑà -->
            <div class="pagination" id="pagination"></div>
        </div>
    </div>
    <script>
        const tempCardId = <%= card.card_id %>;
        let currentPage = <%= JSON.stringify(currentPage) %>;
        let comments = <%- JSON.stringify(comments) %>;
        let totalPages = <%= JSON.stringify(totalPages) %>;
        const user = <%- JSON.stringify(user) %>;
    </script>
    <script src="/js/detail.js"></script>
    <script src="/js/comment.js"></script>
</body>
</html>
